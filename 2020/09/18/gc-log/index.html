<!DOCTYPE html>
<html lang="en">
<head>
<title>GC日志探究 :: 志哥笔记 — 记述码农在家的故事！</title>
<meta content="text/html; charset=utf-8" http-equiv="content-type"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<meta content="JVM中新创建的对象在Eden区分配内存，Eden区空间不足时，触发minorGC回收内存，对于一些大对象则直接分配在老年代，那么这里所谓的大对象到底是多大呢？本文将用测试结果回答这个问题！ 验证目标 本" name="description"/>
<meta content="前沿技术,IT博客,技术笔记,IT Share" name="keywords"/>
<meta content="noodp" name="robots"/>
<link href="https://dongzhi.me/2020/09/18/gc-log/" rel="canonical"/>
<link href="https://dongzhi.me/assets/style.css" rel="stylesheet"/>
<link href="https://dongzhi.me/assets/blue.css" rel="stylesheet"/>
<link href="/img/favicon/favicon_io/apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180"/>
<link href="/img/favicon/favicon_io/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png"/>
<link href="/img/favicon/favicon_io/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png"/>
<link href="/img/favicon/favicon_io/site.webmanifest" rel="manifest"/>
<meta content="en" property="og:locale"/>
<meta content="article" property="og:type"/>
<meta content="GC日志探究 :: 志哥笔记" property="og:title"/>
<meta content="JVM中新创建的对象在Eden区分配内存，Eden区空间不足时，触发minorGC回收内存，对于一些大对象则直接分配在老年代，那么这里所谓的大对象到底是多大呢？本文将用测试结果回答这个问题！ 验证目标 本" property="og:description"/>
<meta content="https://dongzhi.me/2020/09/18/gc-log/" property="og:url"/>
<meta content="GC日志探究" property="og:site_name"/>
<meta content="https://dongzhi.me/img/favicon/blue.png" property="og:image"/>
<meta content="2048" property="og:image:width"/>
<meta content="1024" property="og:image:height"/>
<meta content="2020-09-18 00:00:00 +0000 UTC" property="article:published_time"/>
<link href="https://cdn.jsdelivr.net/gh/bugfix123/CDN@master/modules/plyr/3.6.2/plyr.css" rel="stylesheet"/>
<link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet"/>
</head>
<body class="">
<div class="container center headings--one-size">
<header class="header">
<div class="header__inner">
<div class="header__logo">
<a href="/">
<div class="logo">
    DongZhi.ME
  </div>
</a>
</div>
<div class="menu-trigger">menu</div>
</div>
<nav class="menu">
<ul class="menu__inner menu__inner--desktop">
<li><a href="/">Home</a></li>
<li><a href="/archives">Archives</a></li>
<li><a href="/tags">Tags</a></li>
<li><a href="/search">Search</a></li>
<li><a href="/about">About</a></li>
</ul>
<ul class="menu__inner menu__inner--mobile">
<li><a href="/">Home</a></li>
<li><a href="/archives">Archives</a></li>
<li><a href="/tags">Tags</a></li>
<li><a href="/search">Search</a></li>
<li><a href="/about">About</a></li>
</ul>
</nav>
</header>
<div class="content">
<div class="post">
<h1 class="post-title">
<a href="https://dongzhi.me/2020/09/18/gc-log/">GC日志探究</a></h1>
<div class="post-meta">
<span class="post-date">
        2020-09-18 
      </span>
</div>
<span class="post-tags">
    
    #<a href="https://dongzhi.me/tags/jvm/">JVM</a> 
    
  </span>
<div class="post-content"><div>
<p>JVM中新创建的对象在Eden区分配内存，Eden区空间不足时，触发minorGC回收内存，对于一些大对象则直接分配在老年代，那么这里所谓的大对象到底是多大呢？本文将用测试结果回答这个问题！</p>
<h1 id="验证目标">验证目标<a arialabel="Anchor" class="hanchor" href="#验证目标">⌗</a> </h1>
<p>本文通过简单的例子，不断调大对象的大小来观察分配对象的大小如何影响到JVM的GC过程。</p>
<h1 id="测试案例">测试案例<a arialabel="Anchor" class="hanchor" href="#测试案例">⌗</a> </h1>
<p>测试例子代码如下：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span style="color:#f92672">package</span> <span style="color:#a6e22e">messageSenderTest</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span style="color:#a6e22e">public</span> <span style="color:#a6e22e">class</span> <span style="color:#a6e22e">JVMTest1</span> {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span>    <span style="color:#75715e">// java -Xms20m -Xmx20m -Xmn10m -verbose:gc -XX:+PrintGCDetails -XX:+PrintGCCause -XX:+PrintHeapAtGC -XX:SurvivorRatio=3 messageSenderTest.JVMTest1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">private</span> <span style="color:#a6e22e">static</span> <span style="color:#a6e22e">final</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">MB</span> = <span style="color:#ae81ff">1024</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">1024</span>; <span style="color:#75715e">// 1M
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">private</span> <span style="color:#a6e22e">static</span> <span style="color:#a6e22e">final</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">KB</span> = <span style="color:#ae81ff">1024</span>; <span style="color:#75715e">// 1 kb
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">public</span> <span style="color:#a6e22e">static</span> <span style="color:#a6e22e">void</span> <span style="color:#a6e22e">main</span>(<span style="color:#a6e22e">String</span>[] <span style="color:#a6e22e">args</span>) {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span>        <span style="color:#a6e22e">System</span>.<span style="color:#a6e22e">out</span>.println(<span style="color:#e6db74">"before mark1"</span>);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span>        <span style="color:#66d9ef">byte</span>[] <span style="color:#a6e22e">arr1</span> = <span style="color:#a6e22e">new</span> <span style="color:#66d9ef">byte</span>[<span style="color:#ae81ff">4</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">MB</span>];
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span>        <span style="color:#a6e22e">System</span>.<span style="color:#a6e22e">out</span>.println(<span style="color:#e6db74">"before mark2"</span>);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span>        <span style="color:#75715e">// 1.分配1MB  2.分配2MB  3.分配3071KB 4.分配3MB 5.分配4M 6.分配5M  7.分配6M  8.分配8M  9.分配10M
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">byte</span>[] <span style="color:#a6e22e">arr2</span> = <span style="color:#a6e22e">new</span> <span style="color:#66d9ef">byte</span>[<span style="color:#ae81ff">1024</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">KB</span>];
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span>        <span style="color:#a6e22e">System</span>.<span style="color:#a6e22e">out</span>.println(<span style="color:#e6db74">"after mark2"</span>);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span>        <span style="color:#a6e22e">System</span>.<span style="color:#a6e22e">out</span>.println(<span style="color:#e6db74">"refSize:"</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">arr1</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">arr2</span>.<span style="color:#a6e22e">length</span>);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span>    }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span>}
</code></pre></div><p>JVM参数：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span>java -Xms20m -Xmx20m -Xmn10m -verbose:gc -XX:+PrintGCDetails  -XX:+PrintHeapAtGC -XX:SurvivorRatio=3 messageSenderTest.JVMTest1
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span>
</code></pre></div><p>其中，
-Xms20m：堆的初始大小20m(memory size)
-Xmx20m:堆的最大大小(memory max size)
-Xmn10m:堆的新生代大小(memory new)
-verbose:gc:打印GC日志，标准参数
-XX:+PrintGCDetails: 打印GC日志，非标准参数
-XX:+PrintHeapAtGC: 打印GC前后堆的信息
-XX:SurvivorRatio=3： 新生代中Eden Space和From Space比例为3：1</p>
<p>也是就说，堆的总大小20MB，新生代10MB，老年代10MB，其中，Eden区6MB，S0和S1各2MB。上面代码中先后创建2个字节数组arr1和arr2，arr1大小4MB，</p>
</div></div>
<div class="pagination">
<div class="pagination__title">
<span class="pagination__title-h">Read other posts</span>
<hr/>
</div>
<div class="pagination__buttons">
<span class="button next">
<a href="https://dongzhi.me/2020/09/17/understanding-the-java-memory-model-and-the-garbage-collector/">
<span class="button__text">深入浅出理解Java垃圾收集过程</span>
<span class="button__icon">→</span>
</a>
</span>
</div>
</div>
<aside id="comments" style="
/* background: rgb(183 168 154 / 26%);
border: 1px dashed var(--accent); 
padding: 5px auto;margin: 10px auto;*/
">
<section data-isso-id="https://dongzhi.me/2020/09/18/gc-log/" data-title="GC日志探究" id="isso-thread"></section>
<script async="" data-isso="https://isso.dongzhi.me" data-isso-avatar="true" data-isso-avatar-bg="#f0f0f0" data-isso-avatar-fg="#9abf88 #5698c4 #e279a3 #9163b6 ..." data-isso-css="false" data-isso-feed="false" data-isso-id="thread-id" data-isso-lang="zh" data-isso-max-comments-nested="5" data-isso-max-comments-top="10" data-isso-reply-notifications="true" data-isso-reply-to-self="true" data-isso-require-author="true" data-isso-require-email="true" data-isso-reveal-on-click="5" data-isso-vote="false" data-isso-vote-levels="" onload="setAutoCompleteProperty()" src="https://isso.dongzhi.me/js/embed.min.js"></script>
<script>
	function setAutoCompleteProperty() {
		var authors = document.getElementsByName('author');
		if (authors != null && authors.length > 0) {
			authors[0].setAttribute('autocomplete', 'off');
		}
		var emails = document.getElementsByName('email');
		if (emails != null && emails.length > 0) {
			emails[0].setAttribute('autocomplete', 'off');
		}
		var sites = document.getElementsByName('website');
		if (sites != null && sites.length > 0) {
			sites[0].setAttribute('autocomplete', 'off');
		}
	}
	</script>
</aside>
</div>
</div>
<footer class="footer">
<div class="footer__inner">
<div class="copyright">
<span>© 2020 <a href="https://dongzhi.me/">志哥笔记</a></span>
<span style="margin-right: 10px;">:: Theme by <a href="https://themes.gohugo.io/hugo-theme-terminal/">panr</a></span>
</div>
</div>
</footer>
<script src="https://dongzhi.me/assets/main.js"></script>
<script async="" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<script src="https://cdn.jsdelivr.net/gh/bugfix123/CDN@master/modules/plyr/3.6.2/plyr.polyfilled.min.js"></script>
<script>
    const players = Plyr.setup('.js-player', {
        iconUrl: '/modules/plyr/3.6.2/plyr.svg'
    });
    </script>
<script src="/vconsole.min.js"></script>
<script>  
  var vConsole = new VConsole();
  console.log('Hello world');
</script>
</div>
</body>
</html>
